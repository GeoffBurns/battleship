<style type="text/css">
  /* ----- ./src/animation.css ----- */

  :root {
    --flame1-image: url('https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiyVPDwgCOerXVuOOwGmKnEv2RIJQSvewwDD4ZKyU3C81L9vLKzYqTQ_h7NrBnVTIkXCFkCi75XWm5GargieMg0LWqkrNoOCzp0jyT6K67pog3ZNIp_arZXD890MFfEIple8TRhH8af_Jr9G7tUXmSEPKWtcvgrTDJsm4QkexfAVEBmWW0x4SUIXZiW48e7/s20/flame_20.png');
    --flame2-image: url('https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjZr8wgp1epFzRSAFjadwnhtijiP7tV3NIZBmvoGUsT7Z2ibH1XaFWpeZmtGIETTph82iiBOoPst7RcEpL1F2tWGbreIBJAUpaMZFJgpAXoLdYycJENMhWdy6MHTAwtYSoWQMnC3obJRcUJussdC2NvFaIWEC_-ju-CcCRXsnLbFu424sDNfDRHuyVqgJzQ/s24/flame_24.png');
    --flame-duration: 0.4s;
    --flame2-duration: 0.7s;
    --content-width: 546px;
    --bomb-cursor-image: url('https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjPYWFIADyYijnjxSazsEBcpwOGAFwswzWwYf3omEwx7hSlVEd2Ove6j4HqTk4lpVquj0npaNU12x1EbziZizcUA0fz2RWHW7vJjpmDjgzzC-WiJImTTZ4MOPI7XO40pTnLptxz4PeXh46SOPbRew3yy0GwSNF2yp0Dv_frGoeUApJGdJTfOYNMdITu1Bth/s1600/bomb32.png');
    --cross-cursor-image: url('https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjRIRCNJ4dfzaqmhHTSydWzKvvOoohEF_UTtN02x29xMEDFMgioFvibGO_YCU_ySKWf0Ol2x7hUGUL0boTqk3jO6QkTs9DUnWo9-mXpzgZ1umCKNXJSuJ1u_Kl3PUvRjRlnQtmIkjPycOZAFX-DQgh7WcQMFM546g2MKQG_SaiFgvcAoYyjjFMWod8atEBv/s32/cross32.png');
    --background-image: url('https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhfpKDmTUmNw-gENPSLCPCN49T2R_VA70RaSYW6JnQwnbx56pOaPjtYuc8rInLvPX9ZP2QmNr6kalyXlRpfNTsWp9YQlyCxbNiHgMdxFfoKypmMAogRTSJll4DI5B2avoqu50hKkDtmb8BCiotMjL3BtF_xCRuxCscjgVZFZD5GCl655PJ_fzj5BWmsXL5h/s320/fleet.png');
  }

  .cell.flames::before {
    content: '';
    position: absolute;
    inset: -2px;
    /* slight bleed for edges */
    pointer-events: none;
    background:
        /* a subtle animated glow texture underneath */ radial-gradient(
          closest-side,
          rgba(255, 200, 0, 0.22),
          transparent 70%
        )
        0 0/33% 33%,
      radial-gradient(closest-side, rgba(255, 120, 0, 0.18), transparent 70%)
        16% 20%/40% 40%,
      var(--flame1-image) center/cover no-repeat;
    mix-blend-mode: screen;
    /* lets the flames “light” the content */
    opacity: 0;
    /* will be set by animation */
    filter: saturate(1.15);
    animation: flameFade var(--flame-duration, 0.3s) ease-out forwards;
  }

  .cell.hit.flames::before {
    background: radial-gradient(
          closest-side,
          rgba(255, 200, 0, 0.22),
          transparent 70%
        )
        0 0/33% 33%,
      radial-gradient(closest-side, rgba(255, 120, 0, 0.18), transparent 70%)
        16% 20%/40% 40%,
      var(--flame2-image) center/cover no-repeat;
    animation: flameFade var(--flame2-duration, 0.45s) ease-out forwards;
  }

  .cell.miss::after {
    content: '';
    width: 10px;
    height: 10px;
    border-radius: 50%;
    background: #91a3c6;
    transition: opacity 0.2s ease-in-out;
  }

  .cell.hit {
    color: #ff3b3b;
  }

  .cell.hit::after {
    content: 'X';
    font-size: 90%;
    font-family: Arial, Helvetica, sans-serif;
    font-weight: 900;
    color: #ff3b3b;
    transition: opacity 0.1s ease-in-out;
  }

  .cell.frd-hit::after {
    content: 'X';
    font-size: 130%;
    font-family: Arial, Helvetica, sans-serif;
    font-weight: 900;
    color: #380101;
    transition: opacity 0.1s ease-in-out;
  }

  .cell.frd-sunk {
    border: 2px solid black;
  }

  @keyframes flameFade {
    0% {
      opacity: 1;
      transform: scale(1);
      filter: blur(0) saturate(1.2);
    }

    20% {
      opacity: 0.9;
      transform: scale(1.05);
      filter: blur(0) saturate(1.3);
    }

    40% {
      opacity: 0.7;
      transform: scale(0.9);
      filter: blur(0.5px) saturate(1.25);
    }

    60% {
      opacity: 0.5;
      transform: scale(1.15);
      filter: blur(0.5px) saturate(1.4);
    }

    100% {
      opacity: 0.15;
      transform: scale(1.3);
      filter: blur(1.5px) saturate(1.3);
    }
  }

  .burst {
    animation: burstLighten 0.75s ease-out forwards;
  }

  @keyframes burstLighten {
    0% {
      filter: brightness(200%);
      box-shadow: 0 0 30px rgba(255, 255, 255, 0.9);
    }

    100% {
      filter: brightness(100%);
      box-shadow: none;
    }
  }

  .flash {
    animation: flashLighten 0.55s ease-out forwards;
  }

  @keyframes flashLighten {
    0% {
      filter: brightness(160%);
    }

    100% {
      filter: brightness(100%);
    }
  }
  /* ----- ./src/battle.css ----- */

  .battleship {
    background-image: var(--background-image);
    background-repeat: repeat;
    box-sizing: border-box;
    border-radius: 10px;
    color: #0e1530;
  }

  .battleship.blog {
    width: 546px;
  }

  .hidden {
    display: none;
  }

  .heading-container h1 {
    text-align: center;
    margin: 0;
    font-size: 200%;
    font-family: Arial, Helvetica, sans-serif;
    font-weight: 900;
    color: #380101;
  }

  .heading-container h3 {
    text-align: center;
    margin: 0;
    font-size: 130%;
    font-family: Arial, Helvetica, sans-serif;
    font-weight: 900;
    color: #380101;
  }

  .choose-controls {
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  .choose-container {
    margin-bottom: 13px;
    margin-top: 25px;
  }

  .choose-map-container {
    float: left;
    text-align: left;
  }

  .choose-hunt-container {
    float: right;
    text-align: right;
  }

  .choose-label {
    font-size: 130%;
    font-weight: 900;
  }

  .choose-select {
    font-size: 120%;
    font-weight: bold;
  }

  .player-container {
    display: flex;
    flex-direction: column;
  }

  .player-container.hidden {
    display: none;
  }

  .player-body {
    display: flex;
    flex-direction: column;
  }

  .player-main {
    width: var(--content-width);
    display: flex;
    flex-direction: column;
    gap: 8px;
    margin: 0 auto;
  }

  .panel-container {
    width: var(--content-width);
    margin: 0 auto;
  }

  game-container {
    width: var(--content-width);
    margin: 0 auto;
  }
  .title-wrap {
    width: var(--content-width);
    margin: 0 auto;
    box-sizing: border-box;
    background: rgb(255, 255, 238, 0.4);
    padding: 12px;
    border-radius: 10px;
    border: 1px solid #ffc;
  }
  /* ----- ./src/battleseek.css ----- */

  .centered-title {
    text-align: center;
    margin-top: 0;
    margin-bottom: 12px;
  }

  a img.drop-cap {
    background: transparent;
    box-shadow: none;
  }
  /* ----- ./src/cells.css ----- */

  .board-wrap {
    background: #0e1530;
    padding: 12px;
    border-radius: 10px;
    margin-bottom: 12px;
    border: 1px solid #1b2746;
  }

  .info-wrap {
    background: rgb(255, 255, 238, 0.76);
    padding: 12px;
    border-radius: 10px;
    margin-bottom: 12px;
    border: 1px solid #ffc;
  }

  .board {
    display: grid;
    grid-template-columns: repeat(var(--cols), var(--boxSize));
    grid-template-rows: repeat(var(--rows), var(--boxSize));
    gap: 0px;
    cursor: var(--cross-cursor-image) 16 16, auto;
  }

  .board.bomb {
    cursor: var(--bomb-cursor-image) 26 26, pointer;
  }

  /* destroyed (desaturated) board   */
  .board.destroyed .land.light,
  .board.destroyed .sea.light {
    background: #777;
  }

  .board.destroyed .land.dark,
  .board.destroyed .sea.dark {
    background: #555;
  }

  .cell {
    width: var(--boxSize);
    height: var(--boxSize);
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: bold;
    box-sizing: border-box;
    position: relative;
    overflow: clip;
  }

  .cell.land.light {
    background: #348239;
  }

  .cell.land.dark {
    background: #296334;
  }

  .cell.sea.light {
    background: #1a78d6;
  }

  .cell.sea.dark {
    background: #1761b0;
  }

  .cell.rightEdge.light {
    border-right: 2px solid #024;
  }

  .cell.bottomEdge.light {
    border-bottom: 2px solid #024;
  }

  .cell.rightEdge.dark {
    border-right: 2px solid #000;
  }

  .cell.bottomEdge.dark {
    border-bottom: 2px solid #000;
  }

  .cell.leftEdge.light {
    border-left: 2px solid #000;
  }

  .cell.leftEdge.dark {
    border-left: 2px solid #000;
  }
  /* ----- ./src/panel.css ----- */

  .panel {
    display: flex;
    justify-content: space-between;
    gap: 16px;
  }

  .panel-controls {
    display: flex;
    flex-direction: column;
    gap: 8px;
  }

  .tally-title {
    color: white;
    margin-bottom: 6px;
    margin-top: 0px;
  }

  .tally-box-container {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 8px;
    margin-bottom: 8px;
  }

  .info-container {
    display: flex;
    flex-direction: column;
    align-items: flex-start;
    gap: 4px;
    margin-bottom: 8px;
  }

  .tally-row {
    display: flex;
    gap: 6px;
    align-items: center;
  }

  .tally-col {
    display: flex;
    flex-direction: column;
    gap: 6px;
  }

  .tally-box {
    width: 28px;
    height: 22px;
    border-radius: 4px;
    border: 1px solid rgba(200, 210, 240, 0.06);
    display: grid;
    place-items: center;
    font-weight: 700;
  }

  button {
    padding: 8px 10px;
    border-radius: 8px;
    border: none;
    background: #2b4066;
    color: #aaccff;
    cursor: pointer;
  }

  button:disabled {
    opacity: 0.45;
    cursor: not-allowed;
  }

  span.shortcut {
    color: #fff;
    font-weight: 900;
  }

  .info {
    color: #fff;
  }

  h2 {
    margin: 0 0 12px 0;
  }

  @media (min-width: 1024px) {
    .panel {
      align-self: flex-start;
    }
  }
  /* ----- ./src/status.css ----- */

  .status {
    display: flex;
    flex-wrap: wrap;
    justify-content: space-between;
    gap: 12px;
    font-weight: bold;
    margin-bottom: 6px;
    margin-top: 6px;
    color: #111;
    font-size: 135%;
  }

  .status.medium {
    font-weight: bold;
    height: 52px;
    margin-bottom: 15px;
    margin-top: 15px;
    color: #111;
    font-size: 115%;
  }

  .status.small {
    font-weight: bold;
    height: 30px;
    margin-bottom: 10px;
    margin-top: 10px;
    color: #111;
    font-size: 90%;
  }

  .status.hidden {
    display: none;
  }

  .game-status {
    text-align: left;
  }

  .mode-status {
    text-align: right;
  }
</style>
<div dir="ltr" style="text-align: left" trbidi="on">
  <div style="text-align: left">
    <a
      href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhVNV1yREZJORi4k_r0GYoqZe-013Gj7IbUvqoCMXVy-FphRqZdMVuG_hoojAsBuGGJbms10e7ifynNBWNEddYjMaOQKiK4NjTe7V5VSQqJfw3S0RRvErFLipsa_KGiIUH6cPg_72Xd7vx7eDy91uBbFOLqsXDOo5DLoX-k9DG_aWabGlVkDDRNdWM5liqL/s2545/Jagged%20Coast%20Battle%20XL%2022x10.png"
      style="
        clear: right;
        float: right;
        font-family: Georgia, 'Times New Roman', serif;
        margin-bottom: 1em;
        margin-left: 1em;
        text-align: center;
      "
      ><img
        border="0"
        data-original-height="1610"
        data-original-width="2545"
        height="126"
        src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhVNV1yREZJORi4k_r0GYoqZe-013Gj7IbUvqoCMXVy-FphRqZdMVuG_hoojAsBuGGJbms10e7ifynNBWNEddYjMaOQKiK4NjTe7V5VSQqJfw3S0RRvErFLipsa_KGiIUH6cPg_72Xd7vx7eDy91uBbFOLqsXDOo5DLoX-k9DG_aWabGlVkDDRNdWM5liqL/w200-h126/Jagged%20Coast%20Battle%20XL%2022x10.png"
        width="200"
    /></a>
    <div style="clear: left; float: float">
      <a
        href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhkA3NC3GuKzECNYiejVegDJGXZgf_qi1xufexZQQkWS9USaeOAgOF0BxH5eG4o0jWflLh8XZ2hPlO5YdCSKdUhbE2gyu2AsvfiyqP4TfnIVVbzFz8wulFoYEUqPtCRPDCPMOvBHM7CtsXO7PsgrllL1lmQQQmGUp9lYATqguPQxnf6nJtC_9NuAYHNMDZW/s370/battle-I2.png"
        ><img
          align="left"
          alt="I"
          border="5"
          class="drop-cap"
          height="48"
          src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhkA3NC3GuKzECNYiejVegDJGXZgf_qi1xufexZQQkWS9USaeOAgOF0BxH5eG4o0jWflLh8XZ2hPlO5YdCSKdUhbE2gyu2AsvfiyqP4TfnIVVbzFz8wulFoYEUqPtCRPDCPMOvBHM7CtsXO7PsgrllL1lmQQQmGUp9lYATqguPQxnf6nJtC_9NuAYHNMDZW/s370/battle-I2.png"
          style="
            border-bottom-color: initial;
            border-bottom-style: none;
            border-bottom: medium none;
            border-left-color: initial;
            border-left-style: none;
            border-left: medium none;
            border-right-color: initial;
            border-right-style: none;
            border-right: medium none;
            border-top-color: initial;
            border-top-style: none;
            border-top-width: small;
            margin-bottom: 3px;
            margin-left: 3px;
            margin-right: 3px;
            margin-top: 3px;
            margin: 3px;
            padding-bottom: 1px;
            padding-left: 1px;
            padding-right: 0px;
            padding-top: 0px;
            padding: 0px 0px 1px 1px;
          "
          title="Drop Cap by Geoff" /></a
      >t was school holidays, and I wanted to spend some quality time with my
      daughters. I remembered how much fun I used to have playing
      <strong data-end="392" data-start="360"
        ><a href="https://en.wikipedia.org/wiki/Battleship_(game)"
          >Pencil and Paper Battleships</a
        ></strong
      >
      with my brothers when we were kids. So, I went online to find a version of
      the game we used to play—but none of what I found matched my memories.
      <div style="text-align: left">
        <p data-end="716" data-start="540">
          So I recreated the game from scratch, based on how we played it all
          those years ago. I put together a few game sheets, and to my delight,
          they were a big hit with my daughters.
        </p>
        <p data-end="948" data-start="718">
          To this day, I’m not sure whether my brothers and I invented these
          rules ourselves or adapted them from somewhere else. If any kind
          reader recognizes this version or knows where it might have
          originated, I’d love to hear from you.
        </p>
      </div>
    </div>
  </div>
  <br />
  <div style="clear: both">
    <a
      href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjOTIwq41jfumpkn_YdMfYW1E1eCUosfCPQauiqAKrGzR-QixbuKqJ6HwCT7pF_cFdRX200tKQEuWSW1HdSzTDjHD5xm-vvN8TRYw40hO8KtvkMfOjy7BLKtm3mgdIeHTOVKvM5QOiFXLtMA8jt-nyMyyOkXipAmWlurJr10HBfqU_lPZzbx5ezqhLptZUi/s1024/fam.png"
      style="
        clear: right;
        float: right;
        margin-bottom: 1em;
        margin-left: 1em;
        text-align: center;
      "
      ><img
        border="0"
        data-original-height="1024"
        data-original-width="1024"
        src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjOTIwq41jfumpkn_YdMfYW1E1eCUosfCPQauiqAKrGzR-QixbuKqJ6HwCT7pF_cFdRX200tKQEuWSW1HdSzTDjHD5xm-vvN8TRYw40hO8KtvkMfOjy7BLKtm3mgdIeHTOVKvM5QOiFXLtMA8jt-nyMyyOkXipAmWlurJr10HBfqU_lPZzbx5ezqhLptZUi/w200-h200/fam.png"
        width="120"
    /></a>
    <h3 style="text-align: left">
      <span
        style="color: #134f5c; font-family: Georgia, 'Times New Roman', serif"
        >Burns Family Rules for Battleship</span
      >
    </h3>
    <div style="text-align: left">
      <p data-end="1112" data-start="997">
        Each player uses a game sheet with a grid labeled
        <strong data-end="1063" data-start="1047">“Your Ships”</strong> and a
        corresponding
        <strong data-end="1106" data-start="1084">“Opponent’s Ships”</strong>
        grid.
      </p>
      <h4 style="text-align: left">
        <span style="color: #134f5c">Unit Placement</span>
      </h4>
      <p data-end="1220" data-start="1137">
        Players begin by placing the following battle units on their
        <strong data-end="1214" data-start="1198">“Your Ships”</strong>
        grid:
      </p>
      <ul data-end="1417" data-start="1222">
        <li data-end="1277" data-start="1222">
          Units can be
          <strong data-end="1259" data-start="1237">rotated or flipped</strong>
          in any direction.
        </li>
        <li data-end="1320" data-start="1278">
          Units
          <strong data-end="1319" data-start="1286"
            >must not be placed diagonally</strong
          >.
        </li>
        <li data-end="1417" data-start="1321">
          There must be at least a
          <strong data-end="1366" data-start="1348">one-square gap</strong>
          between all units—<strong data-end="1416" data-start="1385"
            >orthogonally and diagonally</strong
          >.
        </li>
      </ul>
      <p data-end="1477" data-start="1419">
        There are three types of units, each with placement rules:
      </p>
    </div>
  </div>
  <div>
    <a
      href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgJ0cE6pEMybtCnkrhmLyLCuLf0cN8kHD0ivxJDmlf9l4yf_daMwdj7rIiW4GnxrizjRZ0G30mm_sgLL3fsWt8-9GVpC0Udk-M8WvB6H6AVUQnKRsSpIYJmhpPX-MXzLah4pGAjmfnVDBCi/s1600/Sea+Ships+a.png"
      style="
        float: left;
        font-size: 14.6667px;
        margin-bottom: 1em;
        margin-right: 1em;
        width: 25%;
      "
      ><img
        border="0"
        height="95"
        src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgJ0cE6pEMybtCnkrhmLyLCuLf0cN8kHD0ivxJDmlf9l4yf_daMwdj7rIiW4GnxrizjRZ0G30mm_sgLL3fsWt8-9GVpC0Udk-M8WvB6H6AVUQnKRsSpIYJmhpPX-MXzLah4pGAjmfnVDBCi/w200-h95/Sea+Ships+a.png"
        width="130"
    /></a>
    <div style="float: left; margin-left: 1em; width: 37%">
      These ships must be placed in ocean squares on the grid.
    </div>
    <a
      href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEi0xBmZPIDfRnn9f38ZAQCAXuWFMI-MqJLlvUtaInj2j-TMxd7OCSwa44CxBqnrnjvqiSETKO3rMzfOaYbH0Cdx6AR0654iaBcvSZqoJIM-tX2_1mUJBFSeeDQV4pcSHFKC_VQt3py4IN1C/s1600/Sea+Ships+b.png"
      style="
        clear: left;
        float: float;
        font-family: Calibri, sans-serif;
        font-size: 14.6667px;
        margin-bottom: 1em;
        margin-left: 1em;
        width: 25%;
      "
      ><img
        border="0"
        src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEi0xBmZPIDfRnn9f38ZAQCAXuWFMI-MqJLlvUtaInj2j-TMxd7OCSwa44CxBqnrnjvqiSETKO3rMzfOaYbH0Cdx6AR0654iaBcvSZqoJIM-tX2_1mUJBFSeeDQV4pcSHFKC_VQt3py4IN1C/w200-h122/Sea+Ships+b.png"
        width="130"
    /></a>
  </div>
  <br />
  <div style="clear: both">
    <a
      href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjAwvjLJ7HsesasJswsFZ3hUTFs8s7Gpd-zLBsBgm5NCgA8aNCjnAbrPoNVw-idb7NTAn3Z9Fa1Gl4vDLNt6_Zwqi-hWDvHcDIVOnb5jFoG_TdHG8MJfF_88wZjQiaMfh4SlzIVp_lZX6Hh/s1600/Planes.png"
      style="
        clear: left;
        float: left;
        font-family: Calibri, sans-serif;
        font-size: 14.6667px;
        margin-bottom: 1em;
        margin-right: 1em;
      "
      ><img
        border="0"
        src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjAwvjLJ7HsesasJswsFZ3hUTFs8s7Gpd-zLBsBgm5NCgA8aNCjnAbrPoNVw-idb7NTAn3Z9Fa1Gl4vDLNt6_Zwqi-hWDvHcDIVOnb5jFoG_TdHG8MJfF_88wZjQiaMfh4SlzIVp_lZX6Hh/w200-h62/Planes.png"
        width="150"
      />
    </a>

    <div style="clear: left, float: left; margin-left: 1em;">
      These air units can be placed on any&nbsp;squares on the grid.
    </div>
  </div>

  <br />
  <div style="clear: both">
    <a
      href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEht5zRw69v-ePFWdTM4LFYXfoowevZKND8LmYcKwBIDeZQNVW0dYZ_6ddkSY41K8_kiZJ1dBe_o_K2i3BEfGomxvDiNzte8rq5whNalMmNn3HHPJucpUtSSX5NNAcNgkXNEZbzIh0BdduV2/s1600/Ground.png"
      style="
        clear: right;
        float: right;
        font-family: Calibri, sans-serif;
        font-size: 14.6667px;
        margin-bottom: 1em;
        margin-left: 1em;
        widows: 1;
      "
      ><img
        border="0"
        src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEht5zRw69v-ePFWdTM4LFYXfoowevZKND8LmYcKwBIDeZQNVW0dYZ_6ddkSY41K8_kiZJ1dBe_o_K2i3BEfGomxvDiNzte8rq5whNalMmNn3HHPJucpUtSSX5NNAcNgkXNEZbzIh0BdduV2/w200-h80/Ground.png"
        width="150"
    /></a>
    These ground units must be placed on land&nbsp;squares on the grid.
  </div>
  <br /><br />
</div>
<div dir="ltr" style="text-align: left" trbidi="on">
  Refer to the unit tally boxes on each particular map to see how many of each
  to place. Tick them off as you go.
</div>
<div dir="ltr" style="text-align: left" trbidi="on">
  <br />
  <span style="font-family: Calibri">
    <div>
      <div style="clear: both">
        <h4 style="text-align: left">
          <a
            href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEj6kNzYSauwFW4uUJLv4o57RO3zWNC4mLmNct5qHoEonCsowfqt-OxX7miiEFuyNABuz4brxd10h12mYqrKAhPuj5zPVxu4ka-hPgFWupmoNTg-svAxXwvoVL09C8vRkMCGQXB35jedb9QY3Lzz6SxrS3SqMtUB2QEA1sup3N81NKcTuDAFSxrhF0SbF8XF/s2545/Jagged%20Coast%20Battle%20XL%2022x10%20filled.png"
            style="
              clear: right;
              float: right;
              margin-bottom: 1em;
              margin-left: 1em;
            "
            ><img
              border="0"
              data-original-height="1610"
              data-original-width="2545"
              height="126"
              src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEj6kNzYSauwFW4uUJLv4o57RO3zWNC4mLmNct5qHoEonCsowfqt-OxX7miiEFuyNABuz4brxd10h12mYqrKAhPuj5zPVxu4ka-hPgFWupmoNTg-svAxXwvoVL09C8vRkMCGQXB35jedb9QY3Lzz6SxrS3SqMtUB2QEA1sup3N81NKcTuDAFSxrhF0SbF8XF/w200-h126/Jagged%20Coast%20Battle%20XL%2022x10%20filled.png"
              width="200" /></a
          ><span style="color: #134f5c">Taking Turns</span>
        </h4>

        <p data-end="1858" data-start="1756" style="text-align: left">
          Once all units are placed, players take turns firing shots to locate
          and destroy the opponent’s units.
        </p>
        <strong data-end="1638" data-start="1618"
          ><span style="color: #0b5394">Standard Attack:</span></strong
        ><br />
        <ul data-end="2090" data-start="1644">
          <li data-end="1684" data-start="1644">
            Announce a grid location (e.g., “B4”).
          </li>
          <li data-end="1827" data-start="1688">
            Your opponent replies with:
            <ul data-end="1827" data-start="1723">
              <li data-end="1763" data-start="1723">
                <strong data-end="1735" data-start="1725">“Miss”</strong>
                – if there’s nothing there.
              </li>
              <li data-end="1827" data-start="1769">
                <strong data-end="1780" data-start="1771">“Hit”</strong>
                – if part of a unit is located at that square.
              </li>
            </ul>
          </li>
          <li data-end="1945" data-start="1831">
            Mark your “Opponent’s Ships” grid with:
            <ul data-end="1945" data-start="1878">
              <li data-end="1909" data-start="1878">
                A
                <strong data-end="1897" data-start="1882">slash ( / )</strong>
                for a miss.
              </li>
              <li data-end="1945" data-start="1915">
                A
                <strong data-end="1934" data-start="1919">cross ( X )</strong>
                for a hit.
              </li>
            </ul>
          </li>
          <li data-end="2090" data-start="1949">
            When all squares of a unit are hit, your opponent must announce the
            unit’s name (e.g., “Cruiser destroyed”). Cross it off in the tally
            box.
          </li>
        </ul>
        <strong data-end="2124" data-start="2095"
          ><span style="color: #134f5c">Mega Bomb (Special Move):</span></strong
        ><br />
        <ul data-end="2439" data-start="2130">
          <li data-end="2157" data-start="2130">Announce a target square.</li>
          <li data-end="2252" data-start="2161">
            The bomb hits that square
            <strong data-end="2224" data-start="2189"
              >plus all eight adjacent squares</strong
            >
            (the surrounding 3x3 area).
          </li>
          <li data-end="2364" data-start="2256">
            Your opponent announces:
            <ul data-end="2364" data-start="2288">
              <li data-end="2327" data-start="2288">
                Any hits, along with their locations.
              </li>
              <li data-end="2364" data-start="2333">
                Names of any destroyed units.
              </li>
            </ul>
          </li>
          <li data-end="2439" data-start="2368">
            Record the use of a mega bomb by marking an
            <strong data-end="2421" data-start="2414">‘M’</strong> in the tally
            box.
          </li>
        </ul>
        <ol data-end="2439" data-start="1615"></ol>
      </div>
      <h3 style="text-align: left">
        <strong data-end="2462" data-start="2441"
          ><span style="color: #134f5c">Winning the Game:</span></strong
        >
      </h3>
      <div class="separator" style="clear: right; float: float">
        The first player to destroy
        <strong data-end="2500" data-start="2493">all</strong> of their
        opponent’s units wins.&nbsp;names of any ‘Ships’ destroyed. Cross out an
        ‘M’ tally box each time you use a bomb.
      </div>
      <div class="separator" style="clear: right; float: float">
        <div class="MsoNormal" style="margin: 0in 0in 8pt">
          <div class="MsoNormal" style="margin: 0in 0in 8pt">
            <h3><br /></h3>
            <h3><span style="color: #134f5c">Update :</span></h3>
            <div>
              I keep getting feedback that people want quicker games so&nbsp; I
              added some more small maps and re-did the letter code sizes.&nbsp;
            </div>
            <div><br /></div>
            <div><br /></div>
            <div>
              <table
                cellpadding="0"
                cellspacing="0"
                class="tr-caption-container"
                style="float: left"
              >
                <tbody>
                  <tr>
                    <td style="text-align: center">
                      <a
                        href="https://blogger.googleusercontent.com/img/a/AVvXsEj6-S8UbGJ-T_PI0BC3yTKp-Pv2ZwnLiroE6-Vc0EfCE2r6KQo_hId_c2iStl1wSt8kyimoxGFCNgycO0nxcQ5NE3mWBB_e4kqKyP83EkuW-g9ixa-bV37pOGzmzSIm4NwbaZYaBzCye_sXptB9Lm_RkAGqhs5dAFBBG9V444h1Xv04YGW7JIeLr2X8poxX"
                        style="
                          clear: left;
                          margin-bottom: 1em;
                          margin-left: auto;
                          margin-right: auto;
                        "
                        ><img
                          alt=""
                          data-original-height="754"
                          data-original-width="2540"
                          height="59"
                          src="https://blogger.googleusercontent.com/img/a/AVvXsEj6-S8UbGJ-T_PI0BC3yTKp-Pv2ZwnLiroE6-Vc0EfCE2r6KQo_hId_c2iStl1wSt8kyimoxGFCNgycO0nxcQ5NE3mWBB_e4kqKyP83EkuW-g9ixa-bV37pOGzmzSIm4NwbaZYaBzCye_sXptB9Lm_RkAGqhs5dAFBBG9V444h1Xv04YGW7JIeLr2X8poxX=w200-h59"
                          width="200"
                      /></a>
                    </td>
                  </tr>
                  <tr>
                    <td class="tr-caption" style="text-align: center">
                      Jagged Coast SS
                    </td>
                  </tr>
                </tbody>
              </table>
              &nbsp; The maps go from small small to extra large&nbsp;<br /><br />
            </div>
            <div class="separator" style="clear: both; text-align: center">
              <a
                href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEilzlGL6Ag9gIDltbHMNlTOjXpfjEGSSK392Iite35dJqG6XP1jEPM_KvEKR0N7pBfW9DWst79egm7lpQ5ZmaPH41sAyWP46BTcJqjoi7vpTcsbw4qLaRw9-1rTKYUFM3p0fOrSjgO1KGHaxjedJ8kSwkH6qCDqTdSa2LPXU52lUZUOShFivgizQpSxZ7Y3/s2750/Jagged%20Coast%20Battle%2018x7%20fill%20half.png"
                style="margin-left: 1em; margin-right: 1em"
              ></a>
              <table
                cellpadding="0"
                cellspacing="0"
                class="tr-caption-container"
                style="float: right"
              >
                <tbody>
                  <tr>
                    <td style="text-align: center">
                      <a
                        href="https://blogger.googleusercontent.com/img/a/AVvXsEivsW02kd2Gn3Nc0G46p4fgc_ks4I05tkQD9PwqOwADar_x_xQfyHn2c5qzQYJW2SFVMJ7atksDnrVQs8BAbM9JmSkq72Lm56cXzPrkzRnOA7N7Yn-DTK6uSow9YMsHeH47M6YijxlYox5oKHdAAyDULULD0jjDvBUyQGfKluyRyH4CNlgw0J9DgBNuRgwb"
                        style="
                          clear: right;
                          margin-bottom: 1em;
                          margin-left: auto;
                          margin-right: auto;
                        "
                        ><img
                          alt=""
                          data-original-height="732"
                          data-original-width="2650"
                          height="55"
                          src="https://blogger.googleusercontent.com/img/a/AVvXsEivsW02kd2Gn3Nc0G46p4fgc_ks4I05tkQD9PwqOwADar_x_xQfyHn2c5qzQYJW2SFVMJ7atksDnrVQs8BAbM9JmSkq72Lm56cXzPrkzRnOA7N7Yn-DTK6uSow9YMsHeH47M6YijxlYox5oKHdAAyDULULD0jjDvBUyQGfKluyRyH4CNlgw0J9DgBNuRgwb=w200-h55"
                          width="200"
                      /></a>
                    </td>
                  </tr>
                  <tr>
                    <td class="tr-caption" style="text-align: center">
                      Jagged Coast XL
                    </td>
                  </tr>
                </tbody>
              </table>
              <div class="separator" style="clear: both; text-align: center">
                <a
                  href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEilzlGL6Ag9gIDltbHMNlTOjXpfjEGSSK392Iite35dJqG6XP1jEPM_KvEKR0N7pBfW9DWst79egm7lpQ5ZmaPH41sAyWP46BTcJqjoi7vpTcsbw4qLaRw9-1rTKYUFM3p0fOrSjgO1KGHaxjedJ8kSwkH6qCDqTdSa2LPXU52lUZUOShFivgizQpSxZ7Y3/s2750/Jagged%20Coast%20Battle%2018x7%20fill%20half.png"
                  style="margin-left: 1em; margin-right: 1em"
                ></a>
              </div>
            </div>
          </div>
          <div class="MsoNormal" style="margin: 0in 0in 8pt">
            <h1 style="text-align: left">
              <span style="font-family: Calibri"></span>
            </h1>
            <h3><br /></h3>
            <h3><span style="color: #134f5c">Update 2 :&nbsp;</span></h3>
            <div>
              I added a interactive game down the bottom so people could try out
              the different maps.
            </div>
            <div><br /></div>
            <div><br /></div>
            <h1 style="text-align: left">
              <span style="color: #134f5c; font-family: Calibri"
                >Game Sheets</span
              >
            </h1>

            <div>
              <ul style="text-align: left">
                <li>
                  <div style="float: left; width: 35%">
                    <a
                      href="https://drive.google.com/file/d/1hBMGV6ryLgqV54LcLhSwQ9qxkOKIdCiP/view?usp=sharing"
                      >Jagged Coast XS</a
                    >
                  </div>
                  <div style="float: right; width: 65%">18x6</div>
                </li>
                <li>
                  <div style="float: left; width: 35%">
                    <a
                      href="https://drive.google.com/file/d/1D1WTxE01aKfodg6oVV2bcN9HUlSmpzwa/view?usp=drive_link"
                      >Jagged Coast VS</a
                    >
                  </div>

                  <div style="float: right; width: 65%">16x7</div>
                </li>
                <li>
                  <div style="float: left; width: 35%">
                    <a
                      href="https://drive.google.com/file/d/1cLI6YysJN1Z6DIpdGIXKmptu6Rj9X2ZF/view?usp=sharing"
                      >Jagged Coast SS</a
                    >
                  </div>
                  <div style="float: right; width: 65%">18x7</div>
                </li>
                <li>
                  <div style="float: left; width: 35%">
                    <a
                      href="https://drive.google.com/file/d/16fLDCl1nTlN_qwXsc2o2MB-9MiquX24_/view?usp=sharing"
                      >Jagged Coast S</a
                    >
                  </div>
                  <div style="float: right; width: 65%">19x7</div>
                </li>
                <li>
                  <div style="float: left; width: 35%">
                    <a
                      href="https://drive.google.com/file/d/1l_6yA_OjrXJlpXgo-3Ah65I2Ieokg4Ts/view?usp=sharing"
                      >Jagged Coast MS</a
                    >
                  </div>
                  <div style="float: right; width: 65%">18x8</div>
                </li>
                <li>
                  <div style="float: left; width: 35%">
                    <a
                      href="https://drive.google.com/file/d/1zRH0xp1usg9MjkjhPRABoUOewSTAYeAx/view?usp=sharing"
                      >Jagged Coast ML</a
                    >
                  </div>
                  <div style="float: right; width: 65%">18x9</div>
                </li>
                <li>
                  <div style="float: left; width: 35%">
                    <a
                      href="https://drive.google.com/file/d/1xvGzas-u7emwFoBDrz8kW3tdMRRy_CA-/view?usp=sharing"
                      >Jagged Coast L</a
                    >
                  </div>
                  <div style="float: right; width: 65%">18x10</div>
                </li>
                <li>
                  <div style="float: left; width: 35%">
                    <a
                      href="https://drive.google.com/file/d/1kiFFLrF2QysrZ9IUKb4TfhI0_YGTX0FA/view?usp=sharing"
                      >Narrow Coast S</a
                    >
                  </div>
                  <div style="float: right; width: 65%">17x11</div>
                </li>
                <li>
                  <div style="float: left; width: 35%">
                    <a
                      href="https://drive.google.com/file/d/1fXk5I9IoZ5pfYoEuK_rypl8Bu9Jnmmr0/view?usp=sharing"
                      >Jagged Coast LL</a
                    >
                  </div>
                  <div style="float: right; width: 65%">20x10</div>
                </li>
                <li>
                  <div style="float: left; width: 35%">
                    <a
                      href="https://drive.google.com/file/d/1vsiN7zYtlVZFTzkcjLxSiJdqoS9IS8fN/view?usp=sharing"
                      >Narrow Coast M</a
                    >
                  </div>
                  <div style="float: right; width: 65%">17x12</div>
                  <br />
                </li>
                <li>
                  <div style="float: left; width: 35%">
                    <a
                      href="https://drive.google.com/file/d/12HSeK9FjHXcZPC4DnZy_wpqbO88_TbHf/view?usp=sharing"
                      >Jagged Coast VL</a
                    >
                  </div>
                  <div style="float: right; width: 65%">21x10</div>
                  <br />
                </li>
                <li>
                  <div style="float: left; width: 35%">
                    <a
                      href="https://drive.google.com/file/d/1D-9c0x4-_NLdXb1lb17HFjYfb9sHRKMB/view?usp=sharing"
                      >Jagged Coast XL</a
                    >
                  </div>
                  <div style="float: right; width: 65%">22x10</div>
                </li>
              </ul>
            </div>

            <br />
            <br />
            <h1 style="text-align: left">
              <span style="color: #134f5c">
                Battleship Seek (No Hide Yet)&nbsp; -&nbsp; Demo&nbsp; of Maps
              </span>
            </h1>
          </div>
        </div>
      </div>
    </div></span
  >
</div>

<div class="battleship" id="battleship-game">
  <div class="info-wrap">
    <div class="heading-container">
      <h1>Geoff's Battleship</h1>
      <h3>Seek Mode</h3>
      <div class="choose-controls">
        <div class="choose-container choose-map-container">
          <label for="chooseMap" class="choose-label">Choose a Map: </label>
          <select id="chooseMap" class="choose-select"></select>
        </div>
        <div class="choose-container choose-hunt-container">
          <label for="chooseHunt" class="choose-label">Hunt Mode: </label>
          <select id="chooseHunt" class="choose-select"></select>
        </div>
      </div>
    </div>
  </div>

  <div class="game-container">
    <div class="player-container">
      <div class="title-wrap">
        <h2 class="centered-title">Enemy Waters</h2>
      </div>

      <div class="player-body">
        <div class="player-main">
          <div class="board-wrap">
            <div class="board" id="enemy-board"></div>
          </div>

          <div class="info-wrap">
            <div class="status" id="statusLine">
              <div id="gameStatus" class="game-status">
                Click On Square To Fire
              </div>
              <div id="modeStatus" class="mode-status">Single Shot Mode</div>
            </div>
          </div>
        </div>
        <div class="panel-container">
          <div class="board-wrap">
            <div class="panel">
              <div class="panel-controls" id="seek-controls">
                <button class="seek-control" id="newGame" type="button">
                  <span class="shortcut">R</span>estart
                </button>
                <button class="seek-control" id="carpetBtn" type="button">
                  <span class="shortcut">M</span>ega Bomb
                </button>
                <button class="seek-control" id="revealBtn" type="button">
                  Re<span class="shortcut">v</span>eal
                </button>
              </div>
              <div class="tally-box-container">
                <h4 class="tally-title">Tally Boxes</h4>
                <div class="tally-col" id="enemy-tallyBox"></div>
              </div>
              <div class="info-container">
                <div class="info">Shots: <span id="enemy-shots">0 </span></div>
                <div class="info">Hits: <span id="enemy-hits">0 </span></div>
                <div class="info">Sunk: <span id="enemy-sunk">0 / 8</span></div>
                <div class="info" style="display: none">
                  Placed: <span id="enemy-placed">0 </span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script type="text/javascript">
  //<![CDATA[
  ;(() => {
    /* ----- ./src/map.js ----- */

    // geometry helper
    const inRange = (r, c) => element =>
      element[0] == r && element[1] <= c && element[2] >= c

    class Map {
      constructor(title, rows, cols, shipNum, landArea) {
        this.title = title
        this.rows = rows
        this.cols = cols
        this.shipNum = shipNum
        this.landArea = landArea
      }
      inBounds(r, c) {
        return r >= 0 && r < this.rows && c >= 0 && c < this.cols
      }
      inAllBounds(r, c, height, width) {
        return (
          r >= 0 && r + height < this.rows && c + width >= 0 && c < this.cols
        )
      }
      isLand(r, c) {
        return this.landArea.some(inRange(r, c))
      }
    }

    /* ----- ./src/Shape.js ----- */

    // variant helpers
    function rotate(cells) {
      return cells.map(([r, c]) => [c, -r])
    }
    function flipV(cells) {
      return cells.map(([r, c]) => [-r, c])
    }

    function asymmetricVariantsOf(cells) {
      let fliped = flipV(cells)
      return [cells, rotate(cells), fliped, rotate(fliped)]
    }

    function symmetricVariantsOf(cells) {
      let variants = [cells]
      for (let i = 0; i < 3; i++) {
        variants.push(rotate(variants[variants.length - 1]))
      }
      return variants
    }

    function straightVariantsOf(cells) {
      return [cells, rotate(cells)]
    }

    class Shape {
      constructor(letter, symmetry, cells) {
        this.letter = letter
        this.symmetry = symmetry
        this.cells = cells
      }

      variants() {
        switch (this.symmetry) {
          case 'A':
            return asymmetricVariantsOf(this.cells)
          case 'S':
            return [this.cells]
          case 'H':
            return symmetricVariantsOf(this.cells)
          case 'L':
            return straightVariantsOf(this.cells)
          default:
            throw new Error(
              'Unknown symmetry type for ' + JSON.stringify(this, null, 2)
            ) // The 'null, 2' adds indentation for readability);
        }
      }
      type() {
        return terrain.current.shipTypes[this.letter]
      }
      color() {
        return terrain.current.shipColors[this.letter]
      }
      sunkDescription() {
        return terrain.current.sunkDescription(this.letter)
      }
      letterColors() {
        return terrain.current.shipLetterColors[this.letter]
      }
      description() {
        return terrain.current.shipDescription[this.letter]
      }
    }

    class Terrain {
      constructor(
        baseShapes,
        shipSunkDescriptions,
        shipLetterColors,
        shipDescription,
        shipTypes,
        shipColors
      ) {
        this.baseShapes = baseShapes
        this.shipSunkDescriptions = shipSunkDescriptions
        this.shipLetterColors = shipLetterColors
        this.shipDescription = shipDescription
        this.shipTypes = shipTypes
        this.shipColors = shipColors
        this.shipDescription = shipDescription
        this.shapesByLetter = Object.fromEntries(
          baseShapes.map(base => [base.letter, base])
        )
      }

      sunkDescription(letter, middle = ' ') {
        return (
          this.shipDescription[letter] +
          middle +
          this.shipSunkDescriptions[this.shipTypes[letter]]
        )
      }
    }
    const seaAndLand = new Terrain(
      [
        new Shape('U', 'H', [
          [0, 0],
          [1, 0],
          [1, 1],
          [1, 2],
          [1, 3],
          [1, 4],
          [0, 4]
        ]),
        new Shape('G', 'S', [
          [0, 0],
          [1, 1],
          [0, 2],
          [2, 0],
          [2, 2]
        ]),
        new Shape('R', 'H', [
          [0, 0],
          [1, 0],
          [2, 0],
          [2, 1],
          [2, 2]
        ]),
        new Shape('A', 'A', [
          [0, 0],
          [0, 1],
          [0, 2],
          [0, 3],
          [1, 1],
          [1, 2],
          [1, 3],
          [1, 4]
        ]),
        new Shape('J', 'H', [
          [1, 0],
          [1, 1],
          [2, 0],
          [2, 1],
          [2, 2]
        ]),
        new Shape('H', 'N', [
          [0, 1],
          [1, 0],
          [1, 1],
          [1, 2],
          [2, 1]
        ]),
        new Shape('P', 'H', [
          [0, 1],
          [1, 0],
          [1, 1],
          [1, 2]
        ]),
        new Shape('T', 'L', [
          [0, 0],
          [0, 1],
          [0, 2],
          [0, 3],
          [0, 4],
          [0, 5]
        ]),
        new Shape('B', 'L', [
          [0, 0],
          [0, 1],
          [0, 2],
          [0, 3],
          [0, 4]
        ]),
        new Shape('O', 'N', [
          [0, 0],
          [0, 1],
          [1, 0],
          [1, 1]
        ]),
        new Shape('C', 'L', [
          [0, 0],
          [0, 1],
          [0, 2],
          [0, 3]
        ]),
        new Shape('D', 'L', [
          [0, 0],
          [0, 1],
          [0, 2]
        ]),
        new Shape('S', 'L', [
          [0, 0],
          [0, 1]
        ])
      ],
      {
        A: 'Shot Down',
        G: 'Destroyed',
        S: 'Sunk'
      },
      {
        A: '#ff6666',
        T: '#ffccff',
        B: '#66ccff',
        C: '#66ff66',
        O: '#33cc99',
        D: '#ffcc66',
        H: '#ff6699',
        J: '#ff884d',
        P: '#cc99ff',
        G: '#ff99cc',
        R: '#6699ff',
        U: '#ffff66',
        M: '#ffd166'
      },
      {
        A: 'Aircraft Carrier',
        T: 'Tanker',
        B: 'Battleship',
        C: 'Cruiser',
        O: 'Oil Rig',
        D: 'Destroyer',
        S: 'Submarine',
        H: 'Helicopter',
        J: 'Fighter Jet',
        P: 'Airplane',
        G: 'Anti-Aircraft Gun',
        R: 'Radar Station',
        U: 'Underground Bunker'
      },
      {
        A: 'S',
        T: 'S',
        B: 'S',
        C: 'S',
        O: 'S',
        D: 'S',
        S: 'S',
        H: 'A',
        J: 'A',
        P: 'A',
        G: 'G',
        R: 'G',
        U: 'G'
      },
      {
        A: 'rgba(255,102,102,0.3)',
        B: 'rgba(102,204,255,0.3)',
        C: 'rgba(102,255,102,0.3)',
        D: 'rgba(255,204,102,0.3)',
        P: 'rgba(204,153,255,0.3)',
        G: 'rgba(255,153,204,0.3)',
        U: 'rgba(255,255,102,0.3)',
        T: 'rgba(255,204,255,0.3)',
        O: 'rgba(51,204,153,0.3)',
        H: 'rgba(255,102,153,0.3)',
        J: 'rgba(255,136,77,0.3)',
        R: 'rgba(102,153,255,0.3)'
      }
    )

    const terrain = { current: seaAndLand }

    /* ----- ./src/maps.js ----- */

    const gameHost = {
      containerWidth: 520
    }

    const jaggedXS = new Map(
      'Jagged Coast XS',
      6,
      18,
      { A: 0, B: 1, C: 1, D: 1, P: 2, G: 1, U: 1, M: 3 },
      [
        [1, 16, 17],
        [1, 0, 2],
        [1, 16, 17],
        [2, 0, 3],
        [2, 15, 17],
        [3, 15, 17],
        [4, 15, 17],
        [5, 15, 17],
        [3, 0, 7],
        [4, 0, 8],
        [5, 0, 8]
      ]
    )

    const jaggedVS = new Map(
      'Jagged Coast VS',
      7,
      16,
      { A: 1, B: 1, C: 1, D: 1, P: 1, G: 1, U: 1, M: 3 },
      [
        [2, 14, 15],
        [2, 0, 2],
        [2, 14, 15],
        [3, 0, 3],
        [3, 13, 15],
        [4, 13, 15],
        [5, 13, 15],
        [6, 13, 15],
        [4, 0, 7],
        [5, 0, 8],
        [6, 0, 8]
      ]
    )

    const jaggedSS = new Map(
      'Jagged Coast SS',
      7,
      18,
      { A: 1, B: 1, C: 1, D: 1, P: 2, G: 1, U: 1, M: 3 },
      [
        [2, 16, 17],
        [2, 0, 2],
        [2, 16, 17],
        [3, 0, 3],
        [3, 15, 17],
        [4, 15, 17],
        [5, 15, 17],
        [6, 15, 17],
        [4, 0, 7],
        [5, 0, 8],
        [6, 0, 8]
      ]
    )

    const defaultMap = jaggedSS

    const jaggedS = new Map(
      'Jagged Coast S',
      7,
      19,
      { A: 1, B: 1, C: 1, D: 2, P: 2, G: 1, U: 1, M: 3 },
      [
        [1, 16, 18],
        [2, 0, 2],
        [2, 16, 18],
        [3, 0, 3],
        [3, 15, 18],
        [4, 15, 18],
        [5, 15, 18],
        [6, 15, 18],
        [4, 0, 7],
        [5, 0, 8],
        [6, 0, 8]
      ]
    )

    const jaggedMS = new Map(
      'Jagged Coast MS',
      8,
      18,
      { A: 1, B: 1, C: 1, D: 2, P: 2, G: 1, U: 1, M: 3 },
      [
        [2, 14, 16],
        [3, 0, 2],
        [3, 14, 17],
        [4, 0, 3],
        [4, 14, 17],
        [5, 14, 17],
        [6, 14, 17],
        [7, 14, 17],
        [5, 0, 8],
        [6, 0, 10],
        [7, 0, 10]
      ]
    )

    const jaggedM = new Map(
      'Jagged Coast M',
      9,
      17,
      { A: 1, B: 1, C: 1, D: 1, P: 2, G: 2, U: 1, M: 3 },
      [
        [3, 13, 15],
        [4, 0, 2],
        [4, 13, 16],
        [5, 0, 3],
        [5, 13, 16],
        [6, 0, 9],
        [6, 13, 16],
        [7, 0, 16],
        [8, 0, 16]
      ]
    )

    const jaggedML = new Map(
      'Jagged Coast ML',
      9,
      18,
      { A: 1, B: 1, C: 1, D: 2, P: 2, G: 2, U: 1, M: 3 },
      [
        [3, 14, 16],
        [4, 0, 2],
        [4, 14, 17],
        [5, 0, 3],
        [5, 14, 17],
        [6, 0, 10],
        [6, 14, 17],
        [7, 0, 17],
        [8, 0, 17]
      ]
    )
    // gameMapTypes
    class SeaAndLandMaps {
      constructor() {
        this.list = [
          jaggedXS,
          jaggedVS,
          defaultMap,
          jaggedS,
          jaggedMS,
          jaggedM,
          jaggedML,
          new Map(
            'Jagged Coast L',
            10,
            18,
            { A: 1, B: 1, C: 2, D: 2, P: 2, G: 2, U: 1, M: 3 },
            [
              [4, 14, 16],
              [5, 0, 2],
              [5, 14, 17],
              [6, 0, 3],
              [6, 14, 17],
              [7, 0, 10],
              [7, 14, 17],
              [8, 0, 17],
              [9, 0, 17]
            ]
          ),
          new Map(
            'Narrow Coast S',
            11,
            17,
            { A: 1, B: 1, C: 2, D: 2, P: 3, G: 1, U: 1, M: 3 },
            [
              [7, 13, 16],
              [7, 1, 5],
              [8, 13, 16],
              [8, 0, 10],
              [9, 0, 16],
              [10, 0, 16]
            ]
          ),
          new Map(
            'Jagged Coast LL',
            10,
            20,
            { A: 1, B: 1, C: 2, D: 2, P: 3, G: 2, U: 1, M: 3 },
            [
              [4, 16, 18],
              [5, 1, 4],
              [5, 16, 19],
              [6, 1, 6],
              [6, 16, 19],
              [7, 0, 13],
              [7, 16, 19],
              [8, 0, 19],
              [9, 0, 19]
            ]
          ),
          new Map(
            'Narrow Coast M',
            12,
            17,
            { A: 1, B: 1, C: 2, D: 3, P: 4, G: 1, U: 1, M: 3 },
            [
              [8, 13, 16],
              [8, 1, 5],
              [9, 13, 16],
              [9, 0, 10],
              [10, 0, 16],
              [11, 0, 16]
            ]
          ),
          new Map(
            'Jagged Coast VL',
            10,
            21,
            { A: 1, B: 1, C: 2, D: 2, P: 4, G: 2, U: 1, M: 3 },
            [
              [4, 16, 18],
              [5, 1, 4],
              [5, 16, 19],
              [6, 1, 6],
              [6, 16, 19],
              [7, 0, 13],
              [7, 16, 19],
              [8, 0, 20],
              [9, 0, 20]
            ]
          ),
          new Map(
            'Jagged Coast XL',
            10,
            22,
            { A: 1, B: 1, C: 2, D: 3, P: 4, G: 2, U: 1, M: 3 },
            [
              [4, 16, 18],
              [5, 1, 4],
              [5, 16, 19],
              [6, 1, 6],
              [6, 16, 19],
              [7, 0, 13],
              [7, 16, 19],
              [8, 0, 21],
              [9, 0, 21]
            ]
          )
        ]
        this.maxBombs = 3
        this.current = defaultMap
        this.baseShapes = seaAndLand.baseShapes
        this.shipSunkDescriptions = seaAndLand.shipSunkDescriptions
        this.shipLetterColors = seaAndLand.shipLetterColors
        this.shipDescription = seaAndLand.shipDescription
        this.shipTypes = seaAndLand.shipTypes
        this.shipColors = seaAndLand.shipColors
        this.shipDescription = seaAndLand.shipDescription
        this.shapesByLetter = seaAndLand.shapesByLetter
      }

      setTo(index) {
        this.current = this.list[index]
        return this.current.title
      }

      inBounds(r, c) {
        return this.current.inBounds(r, c)
      }

      inAllBounds(r, c, height, width) {
        return this.current.inAllBounds(r, c, height, width)
      }

      isLand(r, c) {
        return this.current.isLand(r, c)
      }
    }

    const seaAndLandMaps = new SeaAndLandMaps()

    const gameMaps = seaAndLandMaps

    /* ----- ./src/chooseUI.js ----- */

    class ChooseUI {
      constructor(list, tagetId) {
        this.list = list
        this.choose = document.getElementById(tagetId)
        this.containerWidth = 520
      }

      setup(callback, defaultIndex = 2) {
        let id = 0
        this.list.forEach(choice => {
          let option = document.createElement('option')
          option.value = id
          option.textContent = choice
          this.choose.appendChild(option)
          if (id === defaultIndex) {
            option.selected = 'selected'
          }
          id++
        })
        this.onChange(callback)
      }

      onChange(callback) {
        this.choose.addEventListener('change', function () {
          const index = this.value
          callback(index)
        })
      }
    }

    const mapUI = new ChooseUI(
      gameMaps.list.map(m => m.title),
      'chooseMap'
    )
    const huntUI = new ChooseUI(['hide', 'seek'], 'chooseHunt')

    /* ----- ./src/utils.js ----- */

    function shuffleArray(array) {
      for (let i = array.length - 1; i > 0; i--) {
        let j = Math.floor(Math.random() * (i + 1))
        let temp = array[i]
        array[i] = array[j]
        array[j] = temp
      }
      return array
    }
    function randomPlaceShape(ship, shipCellGrid) {
      const letter = ship.letter
      const shape = ship.shape()
      if (!shape) throw new Error('No shape for letter ' + letter)
      let variants0 = shape.variants()
      const variants = shuffleArray(variants0)

      // try random placements
      const maxAttempts = 20000
      for (let attempt = 0; attempt < maxAttempts; attempt++) {
        for (const variant of variants) {
          // compute bounds for random origin so variant fits
          const maxR = Math.max(...variant.map(s => s[0]))
          const maxC = Math.max(...variant.map(s => s[1]))
          const r0 = Math.floor(Math.random() * (gameMaps.current.rows - maxR))
          const c0 = Math.floor(Math.random() * (gameMaps.current.cols - maxC))
          if (ship.canPlace(variant, r0, c0, shipCellGrid)) {
            ship.placeVariant(variant, r0, c0)
            ship.addToGrid(shipCellGrid)
            return ship.cells
          }
        }
      }
      return null
    }

    /* ----- ./src/StatusUI.js ----- */

    class StatusUI {
      constructor() {
        this.mode = document.getElementById('modeStatus')
        this.game = document.getElementById('gameStatus')
        this.line = document.getElementById('statusLine')
        this.line2 = document.getElementById('statusLine2')
      }
      clear() {
        this.display('', '')
      }
      display(mode, game) {
        this.mode.textContent = mode
        if (game) {
          this.info(game)
        }
      }
      bombStatus(carpetBombsUsed) {
        return `Bomb Mode (${gameMaps.maxBombs - carpetBombsUsed} left)`
      }
      displayBombStatus(carpetBombsUsed, game) {
        return this.display(this.bombStatus(carpetBombsUsed), game)
      }
      info(game) {
        this.game.textContent = game
      }
    }

    /* ----- ./src/ScoreUI.js ----- */

    class ScoreUI {
      constructor(playerPrefix) {
        // Initialization logic
        //
        this.shots = document.getElementById(playerPrefix + '-shots')
        this.hits = document.getElementById(playerPrefix + '-hits')
        this.sunk = document.getElementById(playerPrefix + '-sunk')
        this.placed = document.getElementById(playerPrefix + '-placed')

        this.shotsLabel = document.getElementById(playerPrefix + '-shots-label')
        this.hitsLabel = document.getElementById(playerPrefix + '-hits-label')
        this.sunkLabel = document.getElementById(playerPrefix + '-sunk-label')
        this.placedLabel = document.getElementById(
          playerPrefix + '-placed-label'
        )
        this.tallyBox = document.getElementById(playerPrefix + '-tallyBox')
      }
      display(ships, shots) {
        this.shots.textContent = shots.toString()
        const hits = ships.reduce((sum, s) => sum + s.hits.size, 0)
        this.hits.textContent = hits.toString()
        const sunkCount = ships.filter(s => s.sunk).length
        this.sunk.textContent = `${sunkCount} / ${ships.length}`
      }
      resetTallyBox() {
        this.tallyBox.innerHTML = ''
      }
      buildShipBox(ship) {
        const box = document.createElement('div')
        const letter = ship.letter
        box.className = 'tally-box'
        if (ship.sunk) {
          box.textContent = 'X'
          box.style.background = '#ff8080'
          box.style.color = '#400'
        } else {
          box.textContent = letter
          box.style.background = gameMaps.shipColors[letter] || '#333'
          box.style.color = gameMaps.shipLetterColors[letter] || '#fff'
        }
        return box
      }
      buildTallyRow(ships, letter, rowList, boxer) {
        boxer = boxer || this.buildShipBox
        const row = document.createElement('div')
        row.className = 'tally-row'
        const matching = ships.filter(s => s.letter === letter)

        matching.forEach(s => {
          const box = boxer(s)
          row.appendChild(box)
        })
        rowList.appendChild(row)
      }
      buildBombRow(rowList, carpetBombsUsed) {
        const row = document.createElement('div')
        row.className = 'tally-row'

        for (let i = 0; i < gameMaps.maxBombs; i++) {
          const box = document.createElement('div')
          box.className = 'tally-box'

          if (i < carpetBombsUsed) {
            box.textContent = 'X'
            box.style.background = '#999'
          } else {
            box.textContent = 'M'
            box.style.background = gameMaps.shipLetterColors['M']
          }
          row.appendChild(box)
        }
        rowList.appendChild(row)
      }
      buildShipTally(ships, boxer) {
        this.resetTallyBox()

        const column = document.createElement('div')
        column.className = 'tally-col'
        this.buildTallyRow(ships, 'P', column, boxer)
        const surfaceContainer = document.createElement('div')
        surfaceContainer.setAttribute('style', 'display:flex;gap:40px;')

        const seaColumn = document.createElement('div')
        seaColumn.className = 'tally-col'
        const landColumn = document.createElement('div')
        landColumn.className = 'tally-col'
        const sea = ['A', 'B', 'C', 'D']
        const land = ['G', 'U']
        for (const letter of sea) {
          this.buildTallyRow(ships, letter, seaColumn, boxer)
        }
        for (const letter of land) {
          this.buildTallyRow(ships, letter, landColumn, boxer)
        }
        surfaceContainer.appendChild(seaColumn)
        surfaceContainer.appendChild(landColumn)

        column.appendChild(surfaceContainer)
        this.tallyBox.appendChild(column)
      }
      buildTally(ships, carpetBombsUsed) {
        this.buildShipTally(ships)
        // bombs row
        this.buildBombRow(this.tallyBox, carpetBombsUsed)
      }

      altBuildTally(ships, carpetBombsUsed, boxer) {
        this.resetTallyBox()
        const surfaceContainer = document.createElement('div')
        surfaceContainer.setAttribute('style', 'display:flex;gap:40px;')

        const seaColumn = document.createElement('div')
        seaColumn.className = 'tally-col'
        const landColumn = document.createElement('div')
        landColumn.className = 'tally-col'
        const sea = ['A', 'B', 'C', 'D']
        const land = ['G', 'U']
        for (const letter of sea) {
          this.buildTallyRow(ships, letter, seaColumn, boxer)
        }

        this.buildTallyRow(ships, 'P', landColumn, boxer)
        for (const letter of land) {
          this.buildTallyRow(ships, letter, landColumn, boxer)
        }
        this.buildBombRow(landColumn, carpetBombsUsed)
        surfaceContainer.appendChild(seaColumn)
        surfaceContainer.appendChild(landColumn)

        this.tallyBox.appendChild(surfaceContainer)
      }
    }

    /* ----- ./src/playerUI.js ----- */

    const gameStatus = new StatusUI()

    class PlayerUI {
      constructor() {
        this.board = {}
        this.placing = false
        this.containerWidth = gameHost.containerWidth
      }

      cellSize() {
        return gameHost.containerWidth / gameMaps.current.cols
      }
      gridCellRawAt(r, c) {
        return this.board.children[r * gameMaps.current.cols + c]
      }
      gridCellAt(r, c) {
        const result = this.gridCellRawAt(r, c)
        if (result?.classList) return result
        throw new Error(
          'Invalid cell' + JSON.stringify(result) + 'at ' + r + ',' + c
        )
      }

      displayAsRevealed(cell, letter) {
        if (cell) {
          cell.style.background =
            gameMaps.shipColors[letter] || 'rgba(255, 209, 102, 0.3)'
          cell.style.color = gameMaps.shipLetterColors[letter] || '#ffd166'
          cell.textContent = letter
        }
      }
      revealShip(ship) {
        for (const [r, c] of ship.cells) {
          const cell = this.gridCellAt(r, c)
          this.displayAsRevealed(cell, ship.letter)
        }
      }

      clearClasses() {
        for (const cell of this.board.children) {
          cell.classList.remove('hit', 'frd-hit', 'frd-sunk', 'miss', 'placed')
        }
      }
      displayAsSunk(cell, letter) {
        // cell.textContent = ''
        cell.classList.add('frd-sunk')
        //  cell.style.background = gameMaps.shipColors[letter] || 'rgba(0,0,0,0.8)'
        // cell.style.color = gameMaps.shipLetterColors[letter] || '#000'
        //cell.classList.remove('hit')
        cell.classList.remove('miss')
      }
      cellSunkAt(r, c, letter) {
        const cell = this.gridCellAt(r, c)
        this.displayAsSunk(cell, letter)
      }

      cellHit(r, c) {
        const cell = this.gridCellAt(r, c)
        cell.classList.add('hit')
      }
      cellMiss(r, c) {
        const cell = this.gridCellAt(r, c)

        if (cell.classList.contains('placed')) return
        cell.classList.add('miss')
      }
      surroundMiss(r, c, cellMiss) {
        if (!cellMiss) return
        // surrounding water misses
        for (let dr = -1; dr <= 1; dr++)
          for (let dc = -1; dc <= 1; dc++) {
            const rr = r + dr
            const cc = c + dc
            if (gameMaps.inBounds(rr, cc)) {
              cellMiss(rr, cc)
            }
          }
      }
      displaySurround(cells, letter, cellMiss, display) {
        for (const [r, c] of cells) {
          // surrounding water misses
          this.surroundMiss(r, c, cellMiss)
          if (display) {
            display(r, c, letter)
          }
        }
      }
      resetBoardSize() {
        const cellSize = this.cellSize()
        this.board.style.setProperty('--cols', gameMaps.current.cols)
        this.board.style.setProperty('--rows', gameMaps.current.rows)
        this.board.style.setProperty('--boxSize', cellSize.toString() + 'px')
        this.board.innerHTML = ''
      }
      buildCell(r, c, onClickCell) {
        const cell = document.createElement('div')
        const land = gameMaps.isLand(r, c)
        const c1 = c + 1
        const r1 = r + 1
        cell.className = 'cell'
        cell.classList.add(land ? 'land' : 'sea')
        const checker = (r + c) % 2 === 0
        cell.classList.add(checker ? 'light' : 'dark')
        if (!land && c1 < gameMaps.current.cols && gameMaps.isLand(r, c1)) {
          cell.classList.add('rightEdge')
        }
        if (c !== 0 && !land && gameMaps.isLand(r, c - 1)) {
          cell.classList.add('leftEdge')
        }
        if (r1 < gameMaps.current.rows && land !== gameMaps.isLand(r1, c)) {
          cell.classList.add('bottomEdge')
        }
        cell.dataset.r = r
        cell.dataset.c = c

        if (onClickCell) {
          cell.addEventListener('click', () => onClickCell(r, c))
        }
        this.board.appendChild(cell)
      }
      buildBoard(onClickCell) {
        this.board.innerHTML = ''
        for (let r = 0; r < gameMaps.current.rows; r++) {
          for (let c = 0; c < gameMaps.current.cols; c++) {
            this.buildCell(r, c, onClickCell)
          }
        }
      }
    }

    /* ----- ./src/Score.js ----- */

    class Score {
      constructor() {
        this.shot = new Set()
        this.autoMisses = 0
      }
      reset() {
        this.shot.clear()
        this.autoMisses = 0
      }
      newShotKey(r, c) {
        const key = `${r},${c}`
        if (this.shot.has(key)) return null
        return key
      }
      createShotKey(r, c) {
        const key = this.newShotKey(r, c)
        if (key) {
          this.shot.add(key)
        }
        return key
      }
      noOfShots() {
        return this.shot.size - this.autoMisses
      }

      addAutoMiss(r, c) {
        const key = this.createShotKey(r, c)
        if (!key) return null // already shot here
        this.autoMisses++
        return key
      }
    }

    /* ----- ./src/Ship.js ----- */

    class Ship {
      constructor(id, symmetry, letter) {
        this.id = id
        this.symmetry = symmetry
        this.letter = letter
        this.cells = []
        this.hits = new Set()
        this.sunk = false
      }
      place(placed) {
        this.cells = placed
        this.hits = new Set()
        this.sunk = false
        return placed
      }
      unplace() {
        this.cells = []
        this.hits = new Set()
        this.sunk = false
      }
      placeCells(variant, r0, c0) {
        let placing = []
        for (const [dr, dc] of variant) {
          const rr = r0 + dr,
            cc = c0 + dc
          placing.push([rr, cc])
        }
        return placing
      }
      placeVariant(variant, r0, c0) {
        this.cells = this.placeCells(variant, r0, c0)
      }
      isRightType(r, c) {
        const shipType = this.type()
        const isLand = gameMaps.isLand(r, c)
        // area rules
        if (shipType === 'G' && !isLand) return false
        if (shipType === 'S' && isLand) return false

        return true
      }
      noTouchCheck(r, c, shipCellGrid) {
        for (let nr = r - 1; nr <= r + 1; nr++)
          for (let nc = c - 1; nc <= c + 1; nc++) {
            if (gameMaps.inBounds(nr, nc) && shipCellGrid[nr][nc]) return false
          }
        return true
      }
      canPlace(variant, r0, c0, shipCellGrid) {
        const placing = this.placeCells(variant, r0, c0)
        if (
          placing.some(([r, c]) => {
            return !gameMaps.inBounds(r, c)
          })
        ) {
          // console.log('out of bounds')
          return false
        }
        if (
          placing.some(([r, c]) => {
            return this.isRightType(r, c) === false
          })
        ) {
          //console.log('wrong type')
          return false
        }

        if (
          placing.some(([r, c]) => {
            return (gameMaps.inBounds(r, c) && shipCellGrid[r][c]) === true
          })
        ) {
          //   console.log('overlapping')
          return false
        }
        if (
          placing.some(([r, c]) => {
            return this.noTouchCheck(r, c, shipCellGrid) === false
          })
        ) {
          //   console.log('touching')
          return false
        }
        // console.log('good')
        return true
      }
      addToGrid(shipCellGrid) {
        const letter = this.letter
        const id = this.id
        for (const [r, c] of this.cells) {
          shipCellGrid[r][c] = { id, letter }
        }
      }
      shape() {
        return gameMaps.shapesByLetter[this.letter]
      }
      sunkDescription(middle = ' ') {
        return terrain.current.sunkDescription(this.letter, middle)
      }
      type() {
        return gameMaps.shipTypes[this.letter]
      }
    }

    /* ----- ./src/player.js ----- */

    class Player {
      constructor(ui) {
        this.ships = []
        this.score = new Score()
        this.opponent = null
        this.UI = ui
        this.shipCellGrid = []
        this.boardDestroyed = false
        this.carpetBombsUsed = 0
        this.preamble0 = 'Your'
        this.preamble = 'You were '
        this.resetShipCells()
        this.displayInfo = gameStatus.info.bind(gameStatus)
      }
      createShips() {
        const ships = []
        let id = 1
        for (const base of gameMaps.baseShapes) {
          const letter = base.letter
          const symmetry = base.symmetry
          const num = gameMaps.current.shipNum[letter]
          for (let i = 0; i < num; i++) {
            ships.push(new Ship(id, symmetry, letter))
            id++
          }
        }
        return ships
      }

      resetShipCells() {
        this.shipCellGrid = Array.from({ length: gameMaps.current.rows }, () =>
          Array(gameMaps.current.cols).fill(null)
        )
      }
      recordAutoMiss(r, c) {
        const key = this.score.addAutoMiss(r, c)
        if (!key) return // already shot here
        this.UI.cellMiss(r, c)
      }
      recordFleetSunk() {
        this.displayInfo('All ' + this.preamble0 + ' Ships Destroyed!')
        this.UI.displayFleetSunk()
        this.boardDestroyed = true
      }
      checkFleetSunk() {
        if (this.ships.every(s => s.sunk)) {
          this.recordFleetSunk()
        }
      }
      shipCellAt(r, c) {
        return this.shipCellGrid[r]?.[c]
      }
      markSunk(ship) {
        ship.sunk = true
        this.sunkWarning(ship)
        this.UI.displaySurround(
          ship.cells,
          ship.letter,
          (r, c) => this.recordAutoMiss(r, c),
          (r, c, letter) => this.UI.cellSunkAt(r, c, letter)
        )
        this.checkFleetSunk()
      }
      sunkDescription(ship) {
        if (this.opponent) {
          return this.preamble0 + ' ' + ship.sunkDescription(' was ')
        }
        return ship.sunkDescription()
      }
      sunkLetterDescription(letter) {
        if (this.opponent) {
          return (
            this.preamble0 + ' ' + gameMaps.sunkDescription(letter, ' was ')
          )
        }
        return gameMaps.sunkDescription(letter)
      }
      sunkWarning(ship) {
        this.displayInfo(this.sunkDescription(ship))
      }

      checkForHit(r, c, key, shipCell) {
        const hitShip = this.ships.find(s => s.id === shipCell.id)
        if (!hitShip) {
          this.UI.cellMiss(r, c)
          return { hit: false, sunk: '' }
        }
        hitShip.hits.add(key)

        this.UI.cellHit(r, c)

        if (hitShip.hits.size === hitShip.cells.length) {
          // ship sunk
          this.markSunk(hitShip)
          return { hit: true, sunkLetter: hitShip.letter }
        }
        return { hit: true, sunkLetter: '' }
      }

      fireShot(r, c, key) {
        const shipCell = this.shipCellAt(r, c)
        if (!shipCell) {
          this.UI.cellMiss(r, c)
          return { hit: false, sunk: '' }
        }
        return this.checkForHit(r, c, key, shipCell)
      }
      hitDescription(hits) {
        if (this.opponent) {
          return this.preamble + ' Hit (x' + hits.toString() + ')'
        } else {
          return hits.toString() + ' Hits'
        }
      }
      updateResultsOfBomb(hits, sunks) {
        if (this.boardDestroyed) {
          // already handled  in updateUI
        } else if (hits === 0) {
          if (this.opponent) {
            this.displayInfo(
              'The Mega Bomb missed ' + this.preamble0 + ' ships'
            )
          } else {
            this.displayInfo('The Mega Bomb missed everything!')
          }
        } else if (sunks.length === 0) {
          this.displayInfo(this.hitDescription(hits))
        } else if (sunks.length === 1) {
          this.displayInfo(
            this.hitDescription(hits) +
              ' and ' +
              this.sunkLetterDescription(sunks)
          )
        } else {
          let message = this.hitDescription(hits) + ','
          for (let sunk of sunks) {
            message += ' and ' + this.sunkLetterDescription(sunk)
          }
          message += ' Destroyed'
          this.displayInfo(message)
        }
      }
      effectById(id, tempEffect) {
        const element = document.getElementById(id)
        this.effect(element, tempEffect)
      }
      effect(element, tempEffect) {
        element.classList.add(tempEffect)
        element.addEventListener(
          'animationend',
          () => {
            element.classList.remove(tempEffect)
          },
          { once: true }
        )
      }
      flash() {
        this.effectById('battleship-game', 'flash')
        this.effect(this.UI.board, 'burst')
      }
      flame(r, c, bomb) {
        if (bomb) {
          const delay = Math.floor(Math.random() * 150) + 80
          setTimeout(() => {
            const cell = this.UI.gridCellAt(r, c)
            this.effect(cell, 'flames')
          }, delay)
        } else {
          const cell = this.UI.gridCellAt(r, c)
          this.effect(cell, 'flames')
        }
      }
      processShot(r, c, bomb) {
        this.flame(r, c, bomb)

        const key = this.score.createShotKey(r, c)
        if (key === null) {
          // if we are here, it is because of carpet bomb, so we can just
          return { hit: false, sunk: '' }
        }

        const result = this.fireShot(r, c, key)

        this.updateUI(this.ships)
        return result
      }
      updateTally(ships, carpetBombsUsed, noOfShots) {
        ships = ships || this.ships
        if (this.UI.placing && this.UI.placeTally) {
          this.UI.placeTally(ships)
        } else if (this.opponent) {
          this.UI.score.display(ships, noOfShots)
          this.UI.score.altBuildTally(ships, carpetBombsUsed)
        } else {
          this.UI.score.display(ships, noOfShots)
          this.UI.score.buildTally(ships, carpetBombsUsed)
        }
      }
    }

    /* ----- ./src/enemyUI.js ----- */

    class EnemyUI extends PlayerUI {
      constructor() {
        super()
        this.board = document.getElementById('enemy-board')
        this.score = new ScoreUI('enemy')
        this.carpetBtn = document.getElementById('carpetBtn')
        this.revealBtn = document.getElementById('revealBtn')
      }
      displayFleetSunk() {
        gameStatus.display('Fleet Destroyed', 'All  - Well Done!')
        this.board.classList.add('destroyed')
      }
      revealAll(ships) {
        for (const ship of ships) {
          this.revealShip(ship)
        }

        gameStatus.display('Enemy Fleet Revealed', 'You Gave Up')
        this.board.classList.add('destroyed')
      }

      displayAsSunk(cell, letter) {
        cell.textContent = letter
        cell.style.color = gameMaps.shipLetterColors[letter] || '#fff'
        cell.style.background =
          gameMaps.shipColors[letter] || 'rgba(255,255,255,0.2)'
        cell.classList.remove('hit')
        cell.classList.remove('miss')
      }
      cellSunkAt(r, c, letter) {
        const cell = this.gridCellAt(r, c)
        this.displayAsSunk(cell, letter)
      }
      clearVisuals() {
        for (const cell of this.board.children) {
          cell.textContent = ''
          cell.style.background = ''
          cell.style.color = ''
          cell.classList.remove('hit', 'frd-hit', 'miss', 'placed')
        }
      }
      reset() {
        this.board.innerHTML = ''
        this.board.classList.remove('destroyed')
        gameStatus.display('Single Shot Mode', 'Click On Square To Fire')
      }
    }
    const enemyUI = new EnemyUI()

    /* ----- ./src/enemy.js ----- */

    class Enemy extends Player {
      constructor(enemyUI) {
        super(enemyUI)
        this.preamble = 'Enemy'
        this.preamble = 'The enemy was '
        this.carpetMode = false
        this.isRevealed = false
      }
      toggleCarpetMode() {
        this.setCarpetMode(!this.carpetMode)
      }
      setCarpetMode(mode) {
        const newMode =
          !(this.isRevealed || this.carpetBombsUsed >= gameMaps.maxBombs) &&
          mode
        if (newMode === this.carpetMode) return
        this.carpetMode = newMode
        if (this.carpetMode) {
          this.UI.board.classList.add('bomb')
        } else {
          this.UI.board.classList.remove('bomb')
        }
        this.updateUI(enemy.ships)
      }

      isCarpetMode() {
        return this.carpetMode && this.carpetBombsUsed >= gameMaps.maxBombs
      }
      placeAll(ships) {
        ships = ships || this.ships

        // attempt whole-board placement; retry if any shape fails
        for (let attempt = 0; attempt < 100; attempt++) {
          this.resetShipCells()

          let ok = true
          for (const ship of ships) {
            const placed = randomPlaceShape(ship, this.shipCellGrid)
            if (!placed) {
              ok = false
              break
            }
          }

          if (ok) return true
        }

        throw new Error('Failed to place all ships after many attempts')
      }
      revealAll() {
        this.UI.clearClasses()
        this.UI.revealAll(this.ships)

        this.boardDestroyed = true
        this.isRevealed = true
      }
      updateUI(ships) {
        ships = ships || this.ships
        // stats
        this.UI.score.display(ships, this.score.noOfShots())
        // mode
        if (this.isRevealed) {
          /// this.UI.modeStatus.textContent = 'Enemy Fleet Revealed' // already done
        } else if (this.boardDestroyed) {
          /// this.UI.displayFleetSunk() // already done
        } else if (this.carpetMode) {
          gameStatus.displayBombStatus(
            this.carpetBombsUsed,
            'Click On Square To Drop Bomb'
          )
          this.UI.carpetBtn.innerHTML =
            '<span class="shortcut">S</span>ingle Shot'
        } else {
          this.UI.carpetBtn.innerHTML =
            '<span class="shortcut">M</span>ega Bomb'
          gameStatus.display('Single Shot Mode', 'Click On Square To Fire')
        }
        // buttons
        this.UI.carpetBtn.disabled =
          this.boardDestroyed ||
          this.isRevealed ||
          this.carpetBombsUsed >= gameMaps.maxBombs
        this.UI.revealBtn.disabled = this.boardDestroyed || this.isRevealed
        this.updateTally(
          this.ships,
          this.carpetBombsUsed,
          this.score.noOfShots()
        )
      }
      onClickCell(r, c) {
        if (enemy.boardDestroyed || enemy.isRevealed) return // no action if game over
        if (enemy.carpetMode && enemy.carpetBombsUsed >= gameMaps.maxBombs) {
          gameStatus.info('No Mega Bombs Left - Switch To Single Shot')

          enemy.setCarpetMode(false)
          return
        }
        if (enemy?.opponent?.boardDestroyed) {
          gameStatus.info('Game Over - No More Shots Allowed')
          return
        }
        enemy.tryFireAt(r, c)
      }
      tryFireAt(r, c) {
        if (!this.score.newShotKey(r, c) && !this.carpetMode) {
          gameStatus.info('Already Shot Here - Try Again')
          return false
        }
        this.fireAt(r, c)
        this.updateUI()
        if (enemy?.opponent) {
          enemy.opponent.seekStep()
        }
        return true
      }
      fireAt(r, c) {
        if (this.carpetMode) {
          // Mega Bomb mode: affect 3x3 area centered on (r,c)
          if (this.carpetBombsUsed >= gameMaps.maxBombs) {
            return
          }
          this.processCarpetBomb(r, c)
          return
        }
        this.processShot(r, c, false)
      }

      processCarpetBomb(r, c) {
        let hits = 0
        let sunks = ''
        this.carpetBombsUsed++
        ;({ hits, sunks } = this.dropBomb(r, c, hits, sunks))
        // update status
        this.updateResultsOfBomb(hits, sunks)

        this.updateBombStatus()
        this.flash()
      }
      dropBomb(r, c, hits, sunks) {
        for (let dr = -1; dr <= 1; dr++) {
          for (let dc = -1; dc <= 1; dc++) {
            const nr = r + dr
            const nc = c + dc
            if (gameMaps.inBounds(nr, nc)) {
              const result = this.processShot(nr, nc, true)
              if (result?.hit) hits++
              if (result?.sunkLetter) sunks += result.sunkLetter
            }
          }
        }
        return { hits, sunks }
      }

      updateBombStatus() {
        gameStatus.displayBombStatus(this.carpetBombsUsed)
        if (this.carpetBombsUsed >= gameMaps.maxBombs) {
          this.setCarpetMode(false)
          gameStatus.display('Single Shot Mode')
        }
      }

      onClickCarpetMode() {
        this.toggleCarpetMode()
      }
      onClickReveal() {
        if (!this.isRevealed) {
          this.revealAll()
          this.updateUI(enemy.ships)
        }
      }
      wireupButtons() {
        this.UI.carpetBtn.addEventListener(
          'click',
          enemy.onClickCarpetMode.bind(enemy)
        )
        this.UI.revealBtn.addEventListener(
          'click',
          enemy.onClickReveal.bind(enemy)
        )
      }
      resetModel() {
        this.setCarpetMode(false)
        this.carpetBombsUsed = 0
        this.boardDestroyed = false
        this.isRevealed = false
        this.score.reset()
        this.ships = this.createShips()
      }
      buildBoard() {
        this.UI.buildBoard(enemy.onClickCell)

        // update destroyed state class
        this.UI.board.classList.toggle('destroyed', this.boardDestroyed)
      }
      resetUI(ships) {
        this.UI.reset()
        // this.UI.clearVisuals()
        this.buildBoard()
        this.placeAll(ships)
        this.updateUI(ships)
      }
    }

    const enemy = new Enemy(enemyUI)

    /* ----- ./src/setup.js ----- */

    function setupDropdowns(boardSetup, refresh, huntMode) {
      // Define urlParams using the current window's search string
      const urlParams = new URLSearchParams(window.location.search)
      const mapChoices = urlParams.getAll('mapName')

      const mapName =
        mapChoices[0] || localStorage.getItem('geoffs-battleship.map-name')

      let mapIndex = gameMaps.list.findIndex(m => m.title === mapName)
      if (mapIndex < 0) mapIndex = 0

      mapUI.setup(function (index) {
        const title = gameMaps.setTo(index)
        boardSetup()
        refresh()
        localStorage.setItem('geoffs-battleship.map-name', title)
      }, mapIndex)

      gameMaps.setTo(mapIndex)

      boardSetup()

      function switchToHide() {
        const params = new URLSearchParams()
        params.append('mapName', gameMaps.current.title)

        const location = `https://geoffburns.github.io/battleship/src?${params.toString()}`
        window.location.href = location
      }
      huntUI.setup(
        function () {
          switch (huntUI.choose.value) {
            case '0':
              if (huntMode !== 'hide') switchToHide()
              break
            case '1':
              break
            default:
              console.log('unknown hunt mode')
              break
          }
        },
        huntMode === 'hide' ? 0 : 1
      )
    }

    /* ----- ./src/enemySetup.js ----- */

    let otherboard = null
    const newGameBtn = document.getElementById('newGame')
    function newGame() {
      if (otherboard) otherboard()
      enemy.resetModel()
      enemy.resetUI(enemy.ships)
    }

    function setupSeekShortcuts(placement) {
      if (placement) {
        document
          .getElementById('newPlace2')
          .addEventListener('click', placement)
      }

      function handleSeekShortcuts(event) {
        switch (event.key) {
          case 'p':
          case 'P':
            if (placement) placement()
            break
          case 'r':
          case 'R':
            newGame()
            break
          case 'v':
          case 'V':
            enemy.onClickReveal()
            break
          case 'm':
          case 'M':
            if (!enemy.carpetMode) enemy.onClickCarpetMode()
            break
          case 's':
          case 'S':
            if (enemy.carpetMode) enemy.onClickCarpetMode()
            break
        }
      }

      document.addEventListener('keydown', handleSeekShortcuts)

      return () => document.removeEventListener('keydown', handleSeekShortcuts)
    }

    function setupEnemy(placement, opponentBoard) {
      otherboard = opponentBoard

      // wire buttons
      newGameBtn.addEventListener('click', newGame)
      enemy.wireupButtons()
      return setupSeekShortcuts(placement)
    }

    /* ----- ./src/battleseek.js ----- */

    setupDropdowns(enemyUI.resetBoardSize.bind(enemyUI), newGame, 'seek')
    setupEnemy()
    // initial
    newGame()
  })()
  //]]>
</script>
